apiVersion: v1
kind: Secret
metadata:
  name: es-ca-cert
  namespace: default
type: Opaque
data:
  http_ca.crt: |
     LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZXVENDQTBHZ0F3SUJBZ0lVTjZaaXBNNTdvSWRoVm81K3JRREg5OW9TcUpFd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1BERTZNRGdHQTFVRUF4TXhSV3hoYzNScFkzTmxZWEpqYUNCelpXTjFjbWwwZVNCaGRYUnZMV052Ym1acApaM1Z5WVhScGIyNGdTRlJVVUNCRFFUQWVGdzB5TlRBMk1qY3hNalF6TVROYUZ3MHlPREEyTWpZeE1qUXpNVE5hCk1Ed3hPakE0QmdOVkJBTVRNVVZzWVhOMGFXTnpaV0Z5WTJnZ2MyVmpkWEpwZEhrZ1lYVjBieTFqYjI1bWFXZDEKY21GMGFXOXVJRWhVVkZBZ1EwRXdnZ0lpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElDRHdBd2dnSUtBb0lDQVFDNApXT2k1VG90K05KdFU5eW1HY3V2cWNJbmVhazFUczBWVithdEg2UjBGcDArM3Y0R0M2dG5QelZNOWpJRHlEUDJ3CnlSalBaMEZnMlVLNkhKSXhLUHdybGVqaXFyTURZY0lsaldpajQ3L2JhTjNmTVdSaVVEblJvTlBaS2dxZmJLcVUKd2cvTWI1bDBLcGFoV05aVFl4aGlFTkFJOUhEL3NKbDhpLzZ4TGJkZVVoL2JKdVpyakFTQW9RaU9VelRXeS8zLwpicWNLYWYyM1AxQUtsa3pLcEhISiszRTVPWXRBZi9oSTVYYmEzcVltL2JCVElIUklTTXMvZ2NaS1pSODBlL3ZoClhoYWdQRmVad05PaHBTSXJUU0ZHSTcrNGJIL1d2bEppdDhBVjNKM3JLN1RUN1FRc0RUMWpkRzhNZnBNV0NaZXMKU3Jicm1NazhzOE04dXZvNEE4ZUhsQy9Wd2F0R2VmZEJFZS96T0o1cTU2bDd1MkMzSVBOZkQ0VUxRSytlc3NnRQp1bXRNR012VkFUMmorczhYL1p2aUNlam9XQ3ZkVUpmL2h1bEgzZDRBenNMa3RLSG1XODRJeER3UUhndEZBdEM3Ck9DZTZpTVJHRU02UVZzb0xIcWQ0QlRraGF0aTgrQ2RCWGU0WXljdnNqRlV2S0Z5WmNZUzUzNmlWRyt0SDJic2EKU2dheHNaZzZQZzd6N0ZuckgrSkdVNmhkWHd4TC9CYjdYdVpQRjdxUmdIcm5relNReDdSanA1QTAwTzA0RHdsOAozRFFKR3RoNEFVc1VQRkFoYU0xU2R5SjczMmo1Y3JwekJJeStVS3YzRWZYWTJPbjNjQUpYSkt1UnhsTTVvcHBpCklXWnVvVWZDNDl6S09hei9FLytkVW5INkd4Z0RWS1RHczJ5Z1hXajAxUUlEQVFBQm8xTXdVVEFkQmdOVkhRNEUKRmdRVUFOMTZhNmExQXlZeDljNE5DYTNjbVdYNnRYVXdId1lEVlIwakJCZ3dGb0FVQU4xNmE2YTFBeVl4OWM0TgpDYTNjbVdYNnRYVXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FnRUFMUE1sCmNNZzBzanl1T01WT2ZsK1hrOXBsc1luNjBkWVZKRnZqa05hVEo4eXpiOGRQVzRRblp2ckt5MlhaY2tubWQyS3cKZ0Izc09TejJraG81L1VSUWpuODN2RTFqZkpGbDVNUTdISmpzYXRyTXRhR051bitnVk95UTE1UTVyb0g5RHlwcgpOeTUzTytWUm0xNWVpTm1MREdqMVFwWE12TkdUT3JLWkJtRGU0MEdPNm1rWTRzZ1N1Ny9wb1AxYURDaiswUE54CmVTcWN0Y0YyS3NGaVpGT29WOVM3ZGM2S3o2VG9MVUNKMnRKQkJuZ1k4UGlCZGNuVE9YL0diQmtOWVU1NTBGUE8KNXRwbCtJRUVWT0p0akhkUDVRR2ZacDNiOExaSW1NSEh0V3ZqemJjL3FJTXlMU1FrVkdMZWVRNVdUSTNFV1NiVgowcy9Nd2wxSGJOZHlYd1J4ZXA0VldzUW9Gd3hKeEhQRFYzditCTFZQNy82cTFMYVpGQzUyd1JPTWlvbVY3d2NBCi9yZ0xmVDMwMEYxWVVhcGtKNGRyL2tDOWhtK21Wam9udTNjbzNXNkJZQmpmQXF5T3llS0JKNVJ2ek0yOEJjVlQKSlF1K000eGpURzZjeko0OS9iSDFvZjRxSC9wUExiSmpUaWVPcFdvd0svOE9vMFNUYmlYVkNmdjJIcGZ2SFBDYwovSkZLQlh2cHdkT2VZNkE4STZMTEQ2RHJQcTBlRlc4YVJNajZiVWVpaWh5YTNGR0FOcDRHZndneUs5S2x6S1NnCnM1dGE4TXpKTEN1aFNNc1A4R3U1Z0FSQUw0a1pDdjVwVHhZd3JIOGo5Tno5V1R5dmtHS0pVNVljWTNaMi9LeUIKc2twK25mQXFoamVXZC81dHlXeEoxenpnNWFDN2xHSUFjeCt1UEljPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
---

apiVersion: v1
kind: ConfigMap
metadata:
  name: elasticsearch-config
  namespace: default
  labels:
    app: elasticsearch 
data:
  elasticsearch.yml: |
    cluster.name: Demo-Elastic
    node.name: ${HOSTNAME} 
    discovery.type: single-node 

    network.host: 0.0.0.0 
    http.port: 9200       
    transport.port: 9300  

    xpack.security.enabled: true
    xpack.security.http.ssl.enabled: false
    xpack.security.transport.ssl.enabled: false

    # xpack.graph.enabled: false
    # xpack.watcher.enabled: false
    # xpack.ml.enabled: false
    
    # xpack.security.authc.api_key.enabled: false 

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: elasticsearch
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: elasticsearch
  template:
    metadata:
      labels:
        app: elasticsearch
    spec:
      containers:
        - name: elasticsearch
          image: docker.elastic.co/elasticsearch/elasticsearch:8.13.4 
          ports:
            - containerPort: 9200
              name: http
            - containerPort: 9300
              name: transport
          env:
            - name: ES_JAVA_OPTS
              value: -Xms1g -Xmx1g 
          resources:
            limits:
              memory: "2Gi" 
              cpu: "1000m"  
            requests:
              memory: "1Gi"
              cpu: "500m"
          volumeMounts:
            - name: config-volume
              mountPath: /usr/share/elasticsearch/config2/elasticsearch.yml 
              subPath: elasticsearch.yml 
            - name: esdata
              mountPath: /usr/share/elasticsearch/data 
      volumes:
        - name: config-volume
          configMap:
            name: elasticsearch-config 
        - name: esdata 
          emptyDir: {} 

---
apiVersion: v1
kind: Service
metadata:
  name: elasticsearch-service
  namespace: default
  labels:
    app: elasticsearch 
spec:
  selector:
    app: elasticsearch 
  ports:
    - protocol: TCP
      name: http 
      port: 9200
      targetPort: 9200
    - protocol: TCP
      name: transport 
      port: 9300
      targetPort: 9300
  type: ClusterIP 